
setTimeout(function(){
  var sc = document.createElement("script");
  sc.type = "text/javascript";
  sc.textContent = `
// the following code is written in "injected.js" and injected to "fantacy.js" automatically by the simple python script named "make_injection.py".

var chatroom = document.getElementById("chatArea");

var EditorUI = {};
var ToolEvents = {};

var ScreenshotUI = {
    Preview: {added: false, visible: false, element: null}, 
    Instruction: {element: null, added: false},
    sendScreenshotBtn: null, 
    sendScreenshotBtnVisible: false,
};

var EditorStatus = {
    texttool: {}, 
    mouse: {x: 0, y:0, down: false, moved:false}, 
    added: false, 
    currentTool: null, 
    editHistory: [], 
    editFuture: []
};

var access_key = null;
var pending_screenshot = null;  // screenshot to be send.
const host = "http://127.0.0.1:32728"


// object documentation

// EditorUI       The object for accessing editor user interface.
// EditorStatus   The object for storing editor status.


// EditorUI.root               the editor element.
// EditorUI.canvas             the editor canvas.
// EditorUI.ctx                the canvas context

// ScreenshotUI.sendScreenshotBtn  the send screenshot button element.

// EditorStatus.ctxImage     the original context image
// EditorStatus.currentTool  the current selected tool.


var editor_current_color = null;
var Colors = {
    red:    [255,  82,  82],
    yellow: [255, 224,  82],
    green:  [ 82, 255, 115],
    blue:   [ 58, 168, 255],
    white:  [250, 250, 250],
    black:  [ 60,  60,  60]
};

const Tools = {PENCIL: 0, RECT: 1, ARROW: 2, TEXT: 3};
const SVGNS = "http://www.w3.org/2000/svg";

const Icons = {
    // icons source file can be found under "/images", here we store the base64 encoded data URI version of each icon.
    confirm:    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnMiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDM0NyA1NS43MjAzNDciCiAgIGhlaWdodD0iMTUuNzI1NTJtbSIKICAgd2lkdGg9IjE1LjcyNTUybW0iCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJjaGVjay5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iNjkyIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjQ4MCIKICAgICBpZD0ibmFtZWR2aWV3NDIxNyIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iMS40MTQyMTM2IgogICAgIGlua3NjYXBlOmN4PSItMjEuNzQ5MzQ1IgogICAgIGlua3NjYXBlOmN5PSIwLjA3ODkyNDg4IgogICAgIGlua3NjYXBlOndpbmRvdy14PSI3NzIiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjIwNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImxheWVyMSIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE3Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNzguMjM1MzUsLTM2Mi4wMjYxMikiCiAgICAgaWQ9ImxheWVyMSI+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNDcuMTc1NzgxLDEuNDE3OTY4OCAyMS42NDQ1MzEsNDMuNjIzMDQ3IDYuNDY4NzUsMzQuMzUzNTE2IEMgNS4wODEsMzMuNTA1ODM2IDMuMjg2OTE4NywzMy44OTExMjUgMi40MTc5Njg4LDM1LjI2NTYyNSBMIDAuNDg0Mzc1LDM4LjMyMjI2NiBjIC0wLjg2ODk2LDEuMzc0NTEgLTAuNDczNjY3NSwzLjIwMzExMSAwLjkxNDA2MjUsNC4wNTA3ODEgNy4yOTgzNTYzLDQuNDY2MDU1IDE0LjY2NDI4MzUsOC45NTkxNzEgMjAuOTMzNTkzNSwxMi43NzM0MzcgMS4zOTEzNSwwLjg0MTcyIDMuMTg5NTMsMC4zOTkxNzMgNC4wMzEyNSwtMC45OTIxODcgTCA1NS4yOTQ5MjIsNi4zMzAwNzgxIGMgMC44NDE3MSwtMS4zOTEzNyAwLjM5OTE4MiwtMy4xODk1NSAtMC45OTIxODgsLTQuMDMxMjUgTCA1MS4yMDcwMzEsMC40MjU3ODEyNSBjIC0xLjQ2ODcsLTAuNzUwNDg0NzkgLTMuMjU1NjM3LC0wLjIzNjYwMjE4IC00LjAzMTI1LDAuOTkyMTg3NTUgeiIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI3OC4yMzUzNSwzNjIuMDI2MTIpIgogICAgICAgaWQ9InJlY3Q0MTM2IgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg==",
    cancel:     "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnMiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDM0NyA1NS43MjAzNDciCiAgIGhlaWdodD0iMTUuNzI1NTJtbSIKICAgd2lkdGg9IjE1LjcyNTUybW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI3OC4yMzUzNSwtMzYyLjAyNjEyKSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxyZWN0CiAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNjc4LDAuNzA3MTA2NzgsLTAuNzA3MTA2NzgsMC43MDcxMDY3OCwwLDApIgogICAgICAgcnk9IjIuOTM1Mjg4MiIKICAgICAgIHk9IjU0LjUwNDg3OSIKICAgICAgIHg9IjQ1NS43NjE3MiIKICAgICAgIGhlaWdodD0iOS40ODgyODQxIgogICAgICAgd2lkdGg9IjcyLjc0MzUxNSIKICAgICAgIGlkPSJyZWN0NDEzNiIKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIC8+CiAgICA8cmVjdAogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTAuNzA3MTA2NzgsMC43MDcxMDY3OCwtMC43MDcxMDY3OCwtMC43MDcxMDY3OCwwLDApIgogICAgICAgcnk9IjIuOTM1Mjg4MiIKICAgICAgIHk9Ii00OTYuODc3NTkiCiAgICAgICB4PSIyMi44NzcyNjQiCiAgICAgICBoZWlnaHQ9IjkuNDg4Mjg0MSIKICAgICAgIHdpZHRoPSI3Mi43NDM1MTUiCiAgICAgICBpZD0icmVjdDQxMzYtMyIKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIC8+CiAgPC9nPgo8L3N2Zz4K",

    forward:    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgd2lkdGg9IjE1LjcyNTYybW0iCiAgIGhlaWdodD0iMTUuNzI1NTE2bW0iCiAgIHZpZXdCb3g9IjAgMCA1NS43MjA3MDIgNTUuNzIwMzMzIgogICBpZD0ic3ZnNDI4OSIKICAgdmVyc2lvbj0iMS4xIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNDI5MSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0Mjk0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDU2LjAyMjA4LDApIgogICAgIGlkPSJnNDMzNCI+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDI3LjgyMjI2NiwxLjUxOTUyOTMgQSAyNi4zNDExNDYsMjYuMzQxMTQ2IDAgMCAwIDIuNzI0NjA5NCwxOS45NzA3MDEgbCA4LjA5NzY1NjYsMCBhIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgMTcsLTEwLjg3NDk5OTggMTguNzYzNTU3LDE4Ljc2MzU1NyAwIDAgMSA0LjkxMjEwOSwwLjY3MzgyODEgTCAzNC43MDg5ODQsMi40NDMzNTc1IEEgMjYuMzQxMTQ2LDI2LjM0MTE0NiAwIDAgMCAyNy44MjIyNjYsMS41MTk1MjkzIFoiCiAgICAgICBpZD0icGF0aDQzMzIiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuODYyNzQ1MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS4yNTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNDAuNzc5Mjk3LDQuOTYyODg4NyAtMy43MTI4OTEsNi41ODAwNzgzIGEgMTguNzYzNTU3LDE4Ljc2MzU1NyAwIDAgMSA4LjQxOTkyMiwxMC4wMjM0MzcgTCA1Mi41OTM3NSwxOS4wMjczNDIgQSAyNi4zNDExNDYsMjYuMzQxMTQ2IDAgMCAwIDQwLjc3OTI5Nyw0Ljk2Mjg4ODcgWiIKICAgICAgIGlkPSJwYXRoNDMzMCIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MC43MDU4ODIzNTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS4yNTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNTMuOTc0NjA5LDI0Ljg2MTMyNiAtNy41MzEyNSwwLjg2NTIzNCBhIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgMC4xNDY0ODUsMi4xMzI4MTMgMTguNzYzNTU3LDE4Ljc2MzU1NyAwIDAgMSAtMS44NTM1MTYsOC4wNzgxMjUgbCA2LjgzMjAzMSwzLjI3MTQ4NCBhIDI2LjM0MTE0NiwyNi4zNDExNDYgMCAwIDAgMi41OTc2NTcsLTExLjM0OTYwOSAyNi4zNDExNDYsMjYuMzQxMTQ2IDAgMCAwIC0wLjE5MTQwNywtMi45OTgwNDcgeiIKICAgICAgIGlkPSJwYXRoNDMyOCIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MC41NDkwMTk2MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS4yNTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNDMuMDM5MDYyLDM4LjgxMjQ5OCBBIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgMzcuMjIwNzAzLDQ0LjA3MDMxIEwgNDEsNTAuNjE3MTg2IGEgMjYuMzQxMTQ2LDI2LjM0MTE0NiAwIDAgMCA4LjE2OTkyMiwtNy4zNzg5MDcgbCAtNi4xMzA4NiwtNC40MjU3ODEgeiIKICAgICAgIGlkPSJwYXRoNDMyNiIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MC4zOTIxNTY4NjtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS4yNTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gMzQuMDc4MTI1LDQ1LjUzNzEwNyBhIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgLTYuMjU1ODU5LDEuMDg1OTM4IGwgMCw3LjU3ODEyNSBhIDI2LjM0MTE0NiwyNi4zNDExNDYgMCAwIDAgOC43NTk3NjUsLTEuNTQ0OTIyIGwgLTIuNTAzOTA2LC03LjExOTE0MSB6IgogICAgICAgaWQ9InBhdGg0MTU2IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjI1O3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyLjE5MzQ3ODksMy4wODI0MTAyIDIxLjE4MzE1NSwyMi4wNzIwODcgMS44NTYwNjQzLDIyLjQwOTUgWiIKICAgICAgIGlkPSJwYXRoNDE3NCIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    backward:   "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgd2lkdGg9IjE1LjcyNTYybW0iCiAgIGhlaWdodD0iMTUuNzI1NTE2bW0iCiAgIHZpZXdCb3g9IjAgMCA1NS43MjA3MDIgNTUuNzIwMzMzIgogICBpZD0ic3ZnNDI4OSIKICAgdmVyc2lvbj0iMS4xIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNDI5MSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0Mjk0Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlkPSJnNDMzNCI+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDI3LjgyMjI2NiwxLjUxOTUyOTMgQSAyNi4zNDExNDYsMjYuMzQxMTQ2IDAgMCAwIDIuNzI0NjA5NCwxOS45NzA3MDEgbCA4LjA5NzY1NjYsMCBhIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgMTcsLTEwLjg3NDk5OTggMTguNzYzNTU3LDE4Ljc2MzU1NyAwIDAgMSA0LjkxMjEwOSwwLjY3MzgyODEgTCAzNC43MDg5ODQsMi40NDMzNTc1IEEgMjYuMzQxMTQ2LDI2LjM0MTE0NiAwIDAgMCAyNy44MjIyNjYsMS41MTk1MjkzIFoiCiAgICAgICBpZD0icGF0aDQzMzIiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuODYyNzQ1MTE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDQwLjc3OTI5Nyw0Ljk2Mjg4ODcgLTMuNzEyODkxLDYuNTgwMDc4MyBhIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgOC40MTk5MjIsMTAuMDIzNDM3IEwgNTIuNTkzNzUsMTkuMDI3MzQyIEEgMjYuMzQxMTQ2LDI2LjM0MTE0NiAwIDAgMCA0MC43NzkyOTcsNC45NjI4ODg3IFoiCiAgICAgICBpZD0icGF0aDQzMzAiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuNzA1ODgyMzc7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDUzLjk3NDYwOSwyNC44NjEzMjYgLTcuNTMxMjUsMC44NjUyMzQgYSAxOC43NjM1NTcsMTguNzYzNTU3IDAgMCAxIDAuMTQ2NDg1LDIuMTMyODEzIDE4Ljc2MzU1NywxOC43NjM1NTcgMCAwIDEgLTEuODUzNTE2LDguMDc4MTI1IGwgNi44MzIwMzEsMy4yNzE0ODQgYSAyNi4zNDExNDYsMjYuMzQxMTQ2IDAgMCAwIDIuNTk3NjU3LC0xMS4zNDk2MDkgMjYuMzQxMTQ2LDI2LjM0MTE0NiAwIDAgMCAtMC4xOTE0MDcsLTIuOTk4MDQ3IHoiCiAgICAgICBpZD0icGF0aDQzMjgiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuNTQ5MDE5NjM7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDQzLjAzOTA2MiwzOC44MTI0OTggQSAxOC43NjM1NTcsMTguNzYzNTU3IDAgMCAxIDM3LjIyMDcwMyw0NC4wNzAzMSBMIDQxLDUwLjYxNzE4NiBhIDI2LjM0MTE0NiwyNi4zNDExNDYgMCAwIDAgOC4xNjk5MjIsLTcuMzc4OTA3IGwgLTYuMTMwODYsLTQuNDI1NzgxIHoiCiAgICAgICBpZD0icGF0aDQzMjYiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuMzkyMTU2ODc7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDM0LjA3ODEyNSw0NS41MzcxMDcgYSAxOC43NjM1NTcsMTguNzYzNTU3IDAgMCAxIC02LjI1NTg1OSwxLjA4NTkzOCBsIDAsNy41NzgxMjUgYSAyNi4zNDExNDYsMjYuMzQxMTQ2IDAgMCAwIDguNzU5NzY1LC0xLjU0NDkyMiBsIC0yLjUwMzkwNiwtNy4xMTkxNDEgeiIKICAgICAgIGlkPSJwYXRoNDE1NiIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS4yNTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMi4xOTM0Nzg5LDMuMDgyNDEwMiAyMS4xODMxNTUsMjIuMDcyMDg3IDEuODU2MDY0MywyMi40MDk1IFoiCiAgICAgICBpZD0icGF0aDQxNzQiIC8+CiAgPC9nPgo8L3N2Zz4K",

    discard:    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iMTUuNzI1NTJtbSIKICAgaGVpZ2h0PSIxNS43MjU1MThtbSIKICAgdmlld0JveD0iMCAwIDU1LjcyMDM0NyA1NS43MjAzNCIKICAgaWQ9InN2ZzYyNDAiCiAgIHZlcnNpb249IjEuMSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC45MSByMTM3MjUiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImRpc2NhcmQuc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNjI0MiIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iOCIKICAgICBpbmtzY2FwZTpjeD0iMzMuODY4NDc4IgogICAgIGlua3NjYXBlOmN5PSIyNi4xNDE2NzMiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImxheWVyMSIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgZml0LW1hcmdpbi10b3A9IjAiCiAgICAgZml0LW1hcmdpbi1sZWZ0PSIwIgogICAgIGZpdC1tYXJnaW4tcmlnaHQ9IjAiCiAgICAgZml0LW1hcmdpbi1ib3R0b209IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIyNTA3IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTYiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjUzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTYyNDUiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zMzIuMTM5ODMsLTQ1My4wNzM0NikiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDAgMCBMIDAgMzEuMjA3MDMxIEwgMTIuODEwNTQ3IDMxLjIwNzAzMSBMIDEyLjgxMDU0NyAyNC43MzQzNzUgTCAyNy41NTQ2ODggMjQuNzM0Mzc1IEwgMjcuNTU0Njg4IDE1LjAyNzM0NCBMIDU1LjcyMDcwMyAxNS4wMjczNDQgTCA1NS43MjA3MDMgMCBMIDAgMCB6ICIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMzMi4xMzk4Myw0NTMuMDczNDYpIgogICAgICAgaWQ9InJlY3Q2ODI2IiAvPgogICAgPHJlY3QKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eTowLjU4ODIzNTMyO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBpZD0icmVjdDY4MjYtNSIKICAgICAgIHdpZHRoPSIxMS4zMzI0NDUiCiAgICAgICBoZWlnaHQ9IjExLjY5MTA2MSIKICAgICAgIHg9IjMzMi4xMzk4MyIKICAgICAgIHk9IjQ4Ny42MjY3NyIKICAgICAgIHJ4PSIwIgogICAgICAgcnk9IjAiIC8+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuNTg4MjM1MzI7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGlkPSJyZWN0NjgyNi01LTYiCiAgICAgICB3aWR0aD0iMTAuNzM0NzQ3IgogICAgICAgaGVpZ2h0PSIxMS4wNzQ0NDkiCiAgICAgICB4PSIzNDcuMzgwMjUiCiAgICAgICB5PSI0ODEuMDM5NjciCiAgICAgICByeD0iMCIKICAgICAgIHJ5PSIwIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eTowLjc0NTA5ODA1O3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDMwLjUzNzEwOSwxOC4xOTMzNTkgMCwxNy4xOTUzMTMgMTUuMzU5Mzc1LDAgMCw4LjY5NTMxMiA5LjgyNDIxOSwwIDAsLTI1Ljg5MDYyNSB6IgogICAgICAgaWQ9InJlY3Q2ODI2LTUtNi0yIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzMyLjEzOTgzLDQ1My4wNzM0NikiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NjIiAvPgogICAgPHJlY3QKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eTowLjE5NjA3ODQzO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBpZD0icmVjdDY4MjYtNS02LTkiCiAgICAgICB3aWR0aD0iNC45MzgxODA0IgogICAgICAgaGVpZ2h0PSI1LjA5NDQ0OTUiCiAgICAgICB4PSIzNDcuNTA1MjUiCiAgICAgICB5PSI0OTUuNjYzMDIiCiAgICAgICByeD0iMCIKICAgICAgIHJ5PSIwIiAvPgogICAgPHJlY3QKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eTowLjM5MjE1Njg3O3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBpZD0icmVjdDY4MjYtNS02LTktMCIKICAgICAgIHdpZHRoPSIxMi44ODExODciCiAgICAgICBoZWlnaHQ9IjEzLjI4ODgxNSIKICAgICAgIHg9IjM2MS41NTE5NCIKICAgICAgIHk9IjQ5Mi42OTI2IgogICAgICAgcng9IjAiCiAgICAgICByeT0iMCIgLz4KICAgIDxyZWN0CiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MC4xOTYwNzg0MztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgICAgaWQ9InJlY3Q2ODI2LTUtNi05LTAtMyIKICAgICAgIHdpZHRoPSI5Ljc3MTQ4NDQiCiAgICAgICBoZWlnaHQ9IjcuMzQ2OTg0OSIKICAgICAgIHg9IjM3OC4wODg2OCIKICAgICAgIHk9IjUwMS40NDY4MSIKICAgICAgIHJ4PSIwIgogICAgICAgcnk9IjAiIC8+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuMzkyMTU2ODc7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGlkPSJyZWN0NjgyNi01LTYtOS02IgogICAgICAgd2lkdGg9IjMuNDU0MzgyOSIKICAgICAgIGhlaWdodD0iMy4zMDYyMjAxIgogICAgICAgeD0iMzU0LjI4NTYxIgogICAgICAgeT0iNDk0LjQ5OTY5IgogICAgICAgcng9IjAiCiAgICAgICByeT0iMCIgLz4KICA8L2c+Cjwvc3ZnPgo=",

    pencil:     "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iMTUuNzI1NTMxbW0iCiAgIGhlaWdodD0iMTUuNzI1NTIxbW0iCiAgIHZpZXdCb3g9IjAgMCA1NS43MjAzODQgNTUuNzIwMzUiCiAgIGlkPSJzdmc0MTc0IgogICB2ZXJzaW9uPSIxLjEiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJwZW5jaWwuc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNDE3NiIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNS42IgogICAgIGlua3NjYXBlOmN4PSIyMi40NzM0MjIiCiAgICAgaW5rc2NhcGU6Y3k9IjIwLjc5MjUxMiIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBmaXQtbWFyZ2luLXRvcD0iMCIKICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiCiAgICAgZml0LW1hcmdpbi1yaWdodD0iMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjI1MDciCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1NiIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iNTMiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjI0IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNDE3OSI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGU+PC9kYzp0aXRsZT4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc4OS4yODI2NywxMzUuNDk3OTcpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0ibSA4MzUuNTM1NjcsLTEzNC4zODA5MiBjIC0xLjM2NzUsLTEuMzY3NDkgLTMuNTY5NzUsLTEuMzY3NDkgLTQuOTM3MjUsMCBsIC0zNS43NjMxLDM1Ljc2MzA5IC0zLjAyODcyLDEwLjM5NjgyOCA1LjkxOTQ2LDUuOTE5NDYgMTAuMzk2ODIsLTMuMDI4NzE5IDM1Ljc2MzEsLTM1Ljc2MzA4OSBjIDEuMzY3NTEsLTEuMzY3NTEgMS4zNjc1MSwtMy41Njk3NSAwLC00LjkzNzI1IGwgLTguMzUwMzEsLTguMzUwMzIgeiBtIC00NC40OTQ0NSw0OC43OTExNTUgLTEuNjY3MTEsNS43MjA3MTEgNS43MjA3MiwtMS42NjcxMDIgLTQuMDUzNjEsLTQuMDUzNjA5IHoiCiAgICAgICBpZD0icmVjdDQxMzYtMyIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgPC9nPgo8L3N2Zz4K",
    rectangle:  "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjE1LjcyNTUybW0iCiAgIGhlaWdodD0iMTUuNzI1NTJtbSIKICAgdmlld0JveD0iMCAwIDU1LjcyMDM0NyA1NS43MjAzNDciCiAgIGlkPSJzdmcyIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJyZWN0LW5ldy5zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMjUwNyIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDU2IgogICAgIGlkPSJuYW1lZHZpZXcxMCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iOC40NzA4NzMzIgogICAgIGlua3NjYXBlOmN4PSIzLjkwNzUxNTUiCiAgICAgaW5rc2NhcGU6Y3k9IjM0LjkxNDI3NSIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iNTMiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjI0IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMiIgLz4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE3Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8cGF0aAogICAgIHN0eWxlPSJjb2xvcjojMDAwMDAwO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1zaXplOm1lZGl1bTtsaW5lLWhlaWdodDpub3JtYWw7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7dGV4dC1kZWNvcmF0aW9uLWxpbmU6bm9uZTt0ZXh0LWRlY29yYXRpb24tc3R5bGU6c29saWQ7dGV4dC1kZWNvcmF0aW9uLWNvbG9yOiMwMDAwMDA7bGV0dGVyLXNwYWNpbmc6bm9ybWFsO3dvcmQtc3BhY2luZzpub3JtYWw7dGV4dC10cmFuc2Zvcm06bm9uZTtkaXJlY3Rpb246bHRyO2Jsb2NrLXByb2dyZXNzaW9uOnRiO3dyaXRpbmctbW9kZTpsci10YjtiYXNlbGluZS1zaGlmdDpiYXNlbGluZTt0ZXh0LWFuY2hvcjpzdGFydDt3aGl0ZS1zcGFjZTpub3JtYWw7Y2xpcC1ydWxlOm5vbnplcm87ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTt2aXNpYmlsaXR5OnZpc2libGU7b3BhY2l0eToxO2lzb2xhdGlvbjphdXRvO21peC1ibGVuZC1tb2RlOm5vcm1hbDtjb2xvci1pbnRlcnBvbGF0aW9uOnNSR0I7Y29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzOmxpbmVhclJHQjtzb2xpZC1jb2xvcjojMDAwMDAwO3NvbGlkLW9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjE7Y29sb3ItcmVuZGVyaW5nOmF1dG87aW1hZ2UtcmVuZGVyaW5nOmF1dG87c2hhcGUtcmVuZGVyaW5nOmF1dG87dGV4dC1yZW5kZXJpbmc6YXV0bztlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgIGQ9Im0gMCwwIDAsMi41IDAsNDguMjQ0MTQxIDM2LjM0NTcwMywwIDAsLTUgTCA1LDQ1Ljc0NDE0MSA1LDUgbCA0MC43NDQxNDEsMCAwLDMxLjM0NTcwMyA1LDAgTCA1MC43NDQxNDEsMCAwLDAgWiIKICAgICBpZD0icGF0aDQxNzMiIC8+CiAgPHBhdGgKICAgICBzdHlsZT0iY29sb3I6IzAwMDAwMDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtc2l6ZTptZWRpdW07bGluZS1oZWlnaHQ6bm9ybWFsO2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO3RleHQtZGVjb3JhdGlvbi1saW5lOm5vbmU7dGV4dC1kZWNvcmF0aW9uLXN0eWxlOnNvbGlkO3RleHQtZGVjb3JhdGlvbi1jb2xvcjojMDAwMDAwO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7YmFzZWxpbmUtc2hpZnQ6YmFzZWxpbmU7dGV4dC1hbmNob3I6c3RhcnQ7d2hpdGUtc3BhY2U6bm9ybWFsO2NsaXAtcnVsZTpub256ZXJvO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7dmlzaWJpbGl0eTp2aXNpYmxlO29wYWNpdHk6MTtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWw7Y29sb3ItaW50ZXJwb2xhdGlvbjpzUkdCO2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVyczpsaW5lYXJSR0I7c29saWQtY29sb3I6IzAwMDAwMDtzb2xpZC1vcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eTowLjcwNTg4MjM3O2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDo1O3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxO2NvbG9yLXJlbmRlcmluZzphdXRvO2ltYWdlLXJlbmRlcmluZzphdXRvO3NoYXBlLXJlbmRlcmluZzphdXRvO3RleHQtcmVuZGVyaW5nOmF1dG87ZW5hYmxlLWJhY2tncm91bmQ6YWNjdW11bGF0ZSIKICAgICBkPSJtIDQwLjY4NTU0Nyw0MC42ODU1NDcgMCwyLjUgMCwxMi41MzUxNTYgMTUuMDM1MTU2LDAgMCwtMTUuMDM1MTU2IC0xNS4wMzUxNTYsMCB6IG0gNSw1IDUuMDM1MTU2LDAgMCw1LjAzNTE1NiAtNS4wMzUxNTYsMCAwLC01LjAzNTE1NiB6IgogICAgIGlkPSJyZWN0NDE0NS0zIgogICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+Cjwvc3ZnPgo=",
    arrow:      "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iCiAgIGhlaWdodD0iMTUuNzI1NTE5bW0iCiAgIHZpZXdCb3g9IjAgMCA1NS43MjAzMyA1NS43MjAzNDMiCiAgIGlkPSJzdmc0ODM0IgogICB2ZXJzaW9uPSIxLjEiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJsaW5lLnN2ZyI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQ4MzYiIC8+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjcuOTE5NTk1OSIKICAgICBpbmtzY2FwZTpjeD0iMTkuODMxMDYzIgogICAgIGlua3NjYXBlOmN5PSIxOC42OTU4NjQiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImxheWVyMSIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgZml0LW1hcmdpbi10b3A9IjAiCiAgICAgZml0LW1hcmdpbi1sZWZ0PSIwIgogICAgIGZpdC1tYXJnaW4tcmlnaHQ9IjAiCiAgICAgZml0LW1hcmdpbi1ib3R0b209IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIyNTA3IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTYiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjUzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTQ4MzkiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkwLjcxNzMxLC0zOTguNzg3NzUpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgICAgaW5rc2NhcGU6dHJhbnNmb3JtLWNlbnRlci15PSIxLjgyNDg1NTYiCiAgICAgICBkPSJtIC03Ni4yMTI2MTYsNDMwLjU2MzAyIC0xNC41MDQ2OTYsLTMxLjc3NTI3IDMxLjc3NTI3NSwxNC41MDQ2OSAtMTIuMTY4MDQ1LDUuMTAyNTMgeiIKICAgICAgIGlkPSJwYXRoNTQ0MSIKICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjY2NjIgogICAgICAgaW5rc2NhcGU6dHJhbnNmb3JtLWNlbnRlci14PSItMS44MjQ4NTE5IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBpbmtzY2FwZTp0cmFuc2Zvcm0tY2VudGVyLXk9IjAuMzA4NzYyOCIKICAgICAgIGQ9Im0gLTc1LjU3MTE5Niw0MTkuNDY3ODggNS41MzQwMTUsLTUuNTM0MDIgMzUuMDQwMjAxLDQwLjU3NDIzIHoiCiAgICAgICBpZD0icGF0aDU0ODkiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjIgogICAgICAgaW5rc2NhcGU6dHJhbnNmb3JtLWNlbnRlci14PSItMC4zMDg3NjEyNSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    addtext:    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNDE3NCIKICAgdmlld0JveD0iMCAwIDU1LjcyMDM4NCA1NS43MjAzNSIKICAgaGVpZ2h0PSIxNS43MjU1MjFtbSIKICAgd2lkdGg9IjE1LjcyNTUzMW1tIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNDE3NiIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0MTc5Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03ODkuMjgyNjcsMTM1LjQ5Nzk3KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxnCiAgICAgICBpZD0idGV4dDQxODIiCiAgICAgICBzdHlsZT0iZm9udC1zdHlsZTpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc2l6ZTo3LjAxNTUxNzIzcHg7bGluZS1oZWlnaHQ6MTI1JTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O2ZpbGw6I2ZhZmFmYTtmaWxsLW9wYWNpdHk6MC43MDU4ODIzNztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDQyMzIiCiAgICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDc4OS4yODI2NywtMTM1LjQ5Nzk3KSIKICAgICAgICAgZD0iTSAxOS45OTgwNDcgMi4yODkwNjI1IEwgMTAuODY1MjM0IDI2Ljk0NzI2NiBMIDE3LjA4Nzg5MSAyNi45NDcyNjYgQSAyLjY2MzkxMzggMi42NjM5MTM4IDAgMCAxIDE5Ljc1MTk1MyAyOS42MTEzMjggTCAxOS43NTE5NTMgMzUuOTY4NzUgTCAyNi4xMDkzNzUgMzUuOTY4NzUgQSAyLjY2MzkxMzggMi42NjM5MTM4IDAgMCAxIDI4Ljc3MzQzOCAzOC42MzI4MTIgTCAyOC43NzM0MzggNDQuMTE1MjM0IEwgMzguMTg3NSA0NC4xMTUyMzQgTCA0MS40MDgyMDMgNTMuNDMxNjQxIEwgNTQuNjY2MDE2IDUzLjQzMTY0MSBMIDM1LjcyMjY1NiAyLjI4OTA2MjUgTCAxOS45OTgwNDcgMi4yODkwNjI1IHogTSAyNy44NzY5NTMgMTQuMjc3MzQ0IEwgMzQuODY1MjM0IDM0LjYyNSBMIDIwLjg1NTQ2OSAzNC42MjUgTCAyNy44NzY5NTMgMTQuMjc3MzQ0IHogTSAyLjU2MjUgNDkuMzYxMzI4IEwgMS4wNTQ2ODc1IDUzLjQzMTY0MSBMIDYuMzU3NDIxOSA1My40MzE2NDEgTCA2LjM1NzQyMTkgNDkuMzYxMzI4IEwgMi41NjI1IDQ5LjM2MTMyOCB6ICIKICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6Ym9sZDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtc2l6ZTo3MC4xNTUxNjY2M3B4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonc2Fucy1zZXJpZiBCb2xkJztmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjAuNzA1ODgyMzciIC8+CiAgICA8L2c+CiAgICA8cGF0aAogICAgICAgaWQ9InJlY3Q0MTg2IgogICAgICAgZD0ibSA3OTguMzA0MTUsLTEwNS44ODcgMCw5LjAyMTQ4NyAtOS4wMjE0OCwwIDAsOC4wNjQ0NTQgOS4wMjE0OCwwIDAsOS4wMjM0MzcgOC4wNjY0MSwwIDAsLTkuMDIzNDM3IDkuMDIxNDksMCAwLC04LjA2NDQ1NCAtOS4wMjE0OSwwIDAsLTkuMDIxNDg3IC04LjA2NjQxLDAgeiIKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjI1O3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiAvPgogICAgPHBhdGgKICAgICAgIGlkPSJyZWN0NDE4Ni03IgogICAgICAgZD0ibSA3OTguMzA0MTUsLTEwNS44ODY5OSAwLDkuMDIxNDc1IC05LjAyMTQ4LDAgMCw4LjA2NDQ2MyA5LjAyMTQ4LDAgMCw5LjAyMzQzIDguMDY2NDEsMCAwLC05LjAyMzQzIDkuMDIxNDksMCAwLC04LjA2NDQ2MyAtOS4wMjE0OSwwIDAsLTkuMDIxNDc1IC04LjA2NjQxLDAgeiIKICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmFmYWZhO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjI1O3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiAvPgogIDwvZz4KPC9zdmc+Cg==",

    dot_red:    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNTQ5MiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDMzIDU1LjcyMDM0IgogICBoZWlnaHQ9IjE1LjcyNTUxOG1tIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM1NDk0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTU0OTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNC45OTY5OCwtNTE4Ljc4Nzc1KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxjaXJjbGUKICAgICAgIHI9IjE5LjU3MTcwNyIKICAgICAgIGN5PSI1NDYuNjQ3OTUiCiAgICAgICBjeD0iMTQyLjg1NzE1IgogICAgICAgaWQ9InBhdGg2MDU4IgogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZjUyNTI7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    dot_yellow: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNTQ5MiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDMzIDU1LjcyMDM0IgogICBoZWlnaHQ9IjE1LjcyNTUxOG1tIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM1NDk0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTU0OTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNC45OTY5OCwtNTE4Ljc4Nzc1KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxjaXJjbGUKICAgICAgIHI9IjE5LjU3MTcwNyIKICAgICAgIGN5PSI1NDYuNjQ3OTUiCiAgICAgICBjeD0iMTQyLjg1NzE1IgogICAgICAgaWQ9InBhdGg2MDU4IgogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmUwNTI7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    dot_green:  "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNTQ5MiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDMzIDU1LjcyMDM0IgogICBoZWlnaHQ9IjE1LjcyNTUxOG1tIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM1NDk0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTU0OTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNC45OTY5OCwtNTE4Ljc4Nzc1KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxjaXJjbGUKICAgICAgIHI9IjE5LjU3MTcwNyIKICAgICAgIGN5PSI1NDYuNjQ3OTUiCiAgICAgICBjeD0iMTQyLjg1NzE1IgogICAgICAgaWQ9InBhdGg2MDU4IgogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiM1MmZmNzM7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    dot_blue:   "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNTQ5MiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDMzIDU1LjcyMDM0IgogICBoZWlnaHQ9IjE1LjcyNTUxOG1tIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM1NDk0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTU0OTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNC45OTY5OCwtNTE4Ljc4Nzc1KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxjaXJjbGUKICAgICAgIHI9IjE5LjU3MTcwNyIKICAgICAgIGN5PSI1NDYuNjQ3OTUiCiAgICAgICBjeD0iMTQyLjg1NzE1IgogICAgICAgaWQ9InBhdGg2MDU4IgogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiMzYWE4ZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    dot_white:  "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNTQ5MiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDMzIDU1LjcyMDM0IgogICBoZWlnaHQ9IjE1LjcyNTUxOG1tIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM1NDk0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTU0OTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNC45OTY5OCwtNTE4Ljc4Nzc1KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxjaXJjbGUKICAgICAgIHI9IjE5LjU3MTcwNyIKICAgICAgIGN5PSI1NDYuNjQ3OTUiCiAgICAgICBjeD0iMTQyLjg1NzE1IgogICAgICAgaWQ9InBhdGg2MDU4IgogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYWZhZmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
    dot_black:  "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNTQ5MiIKICAgdmlld0JveD0iMCAwIDU1LjcyMDMzIDU1LjcyMDM0IgogICBoZWlnaHQ9IjE1LjcyNTUxOG1tIgogICB3aWR0aD0iMTUuNzI1NTE1bW0iPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM1NDk0IiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTU0OTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExNC45OTY5OCwtNTE4Ljc4Nzc1KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxjaXJjbGUKICAgICAgIHI9IjE5LjU3MTcwNyIKICAgICAgIGN5PSI1NDYuNjQ3OTUiCiAgICAgICBjeD0iMTQyLjg1NzE1IgogICAgICAgaWQ9InBhdGg2MDU4IgogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiMzYzNjM2M7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",

    drop_down:  "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNS4wMDAwMDE0bW0iCiAgIGhlaWdodD0iMi41NDExMjA1bW0iCiAgIHZpZXdCb3g9IjAgMCAxNy43MTY1NDEgOS4wMDM5NzAzIgogICBpZD0ic3ZnNDM5OCIKICAgdmVyc2lvbj0iMS4xIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkxIHIxMzcyNSIKICAgc29kaXBvZGk6ZG9jbmFtZT0iZHJvcGRvd24uc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNDQwMCIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTEuMiIKICAgICBpbmtzY2FwZTpjeD0iMTguMTkzNTc3IgogICAgIGlua3NjYXBlOmN5PSItNC4wMjI2NjYyIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGZpdC1tYXJnaW4tdG9wPSIwIgogICAgIGZpdC1tYXJnaW4tbGVmdD0iMCIKICAgICBmaXQtbWFyZ2luLXJpZ2h0PSIwIgogICAgIGZpdC1tYXJnaW4tYm90dG9tPSIwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMjUwNyIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDU2IgogICAgIGlua3NjYXBlOndpbmRvdy14PSI1MyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMjQiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0NDAzIj4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaWQ9ImxheWVyMSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTU3LjczMjc5LC0yNTQuNjkzODIpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzgyODI4MjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGlua3NjYXBlOnRyYW5zZm9ybS1jZW50ZXIteT0iMi41ODQ0MjM4IgogICAgICAgZD0ibSAxNjEuNDQ0MywyNTYuNTgwMSAxMC4yOTM1MiwwIC01LjE0Njc2LDUuMjMxNDEgeiIKICAgICAgIGlkPSJwYXRoNDk0Ni0yIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo=",
}

function inject_style(s){
    var stl = document.createElement("style");
    stl.textContent = s;
    document.head.appendChild(stl); 
}

// binary to ascii (utf-8 string to base64 string)
// ============================================================================================
var fromCharCode = String.fromCharCode;
var btoaUTF8 = (function(btoa, replacer){"use strict";
    return function(inputString, BOMit){
        return btoa((BOMit ? "\xEF\xBB\xBF" : "") + inputString.replace(
            /[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g, replacer
        ));
    }
})(btoa, function(nonAsciiChars){"use strict";
    // make the UTF string into a binary UTF-8 encoded string
    var point = nonAsciiChars.charCodeAt(0);
    if (point >= 0xD800 && point <= 0xDBFF) {
        var nextcode = nonAsciiChars.charCodeAt(1);
        if (nextcode !== nextcode) // NaN because string is 1 code point long
            return fromCharCode(0xef/*11101111*/, 0xbf/*10111111*/, 0xbd/*10111101*/);
        // https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae
        if (nextcode >= 0xDC00 && nextcode <= 0xDFFF) {
            point = (point - 0xD800) * 0x400 + nextcode - 0xDC00 + 0x10000;
            if (point > 0xffff)
                return fromCharCode(
                    (0x1e/*0b11110*/<<3) | (point>>>18),
                    (0x2/*0b10*/<<6) | ((point>>>12)&0x3f/*0b00111111*/),
                    (0x2/*0b10*/<<6) | ((point>>>6)&0x3f/*0b00111111*/),
                    (0x2/*0b10*/<<6) | (point&0x3f/*0b00111111*/)
                );
        } else return fromCharCode(0xef, 0xbf, 0xbd);
    }
    if (point <= 0x007f) return inputString;
    else if (point <= 0x07ff) {
        return fromCharCode((0x6<<5)|(point>>>6), (0x2<<6)|(point&0x3f));
    } else return fromCharCode(
        (0xe/*0b1110*/<<4) | (point>>>12),
        (0x2/*0b10*/<<6) | ((point>>>6)&0x3f/*0b00111111*/),
        (0x2/*0b10*/<<6) | (point&0x3f/*0b00111111*/)
    );
});

// ascii to binary (base64 string to utf-8 string)
// ============================================================================================
var clz32 = Math.clz32 || (function(log, LN2){"use strict";
    return function(x) {return 31 - log(x >>> 0) / LN2 | 0};
})(Math.log, Math.LN2);
var fromCharCode = String.fromCharCode;
var atobUTF8 = (function(atob, replacer){"use strict";
    return function(inputString, keepBOM){
        if (!keepBOM && inputString.substring(0,3) === "\xEF\xBB\xBF")
            inputString = inputString.substring(3); // eradicate UTF-8 BOM
        // 0xc0 => 0b11000000; 0xff => 0b11111111; 0xc0-0xff => 0b11xxxxxx
        // 0x80 => 0b10000000; 0xbf => 0b10111111; 0x80-0xbf => 0b10xxxxxx
        return atob(inputString).replace(/[\xc0-\xff][\x80-\xbf]*/g, replacer);
    }
})(atob, function(encoded){"use strict";
    var codePoint = encoded.charCodeAt(0) << 24;
    var leadingOnes = clz32(~codePoint);
    var endPos = 0, stringLen = encoded.length;
    var result = "";
    if (leadingOnes < 5 && stringLen >= leadingOnes) {
        codePoint = (codePoint<<leadingOnes)>>>(24+leadingOnes);
        for (endPos = 1; endPos < leadingOnes; ++endPos)
            codePoint = (codePoint<<6) | (encoded.charCodeAt(endPos)&0x3f/*0b00111111*/);
        if (codePoint <= 0xFFFF) { // BMP code point
            result += fromCharCode(codePoint);
        } else if (codePoint <= 0x10FFFF) {
            // https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae
            codePoint -= 0x10000;
            result += fromCharCode(
            (codePoint >> 10) + 0xD800,  // highSurrogate
            (codePoint & 0x3ff) + 0xDC00 // lowSurrogate
            );
        } else endPos = 0; // to fill it in with INVALIDs
    }
    for (; endPos < stringLen; ++endPos) result += "\ufffd"; // replacement character
    return result;
});

class duckDrop extends Event{
    constructor(target_element, x, y, df=null){

    super("drop");

    var de = new DragEvent("drop");
    if (df==null){
        df = new DataTransfer();
    }

    this.clientX = x;
    this.clientY = y;
    this.layerX = x;
    this.layerY = y;
    this.pageX = x;
    this.pageY = y;
    this.screenX = x;
    this.screenY = y;
    this.x = x;
    this.y = y;

    this.movementX = 0;
    this.movementY = 0;
    this.offsetX = 0;
    this.offsetY = 0;

    this.altKey = false;
    this.button = 0;
    this.buttons = 0;
    this.cancelBubble = false;

    this.ctrlKey = false;
    this.dataTransfer = df;
    this.detail = 0;
    this.metaKey = false;
    this.mozInputSource = 1;
    this.mozPressure = 0;
    this.rangeOffset = 0;
    this.rangeParent = null;
    this.region = "";
    this.relatedTarget = null;
    this.shiftKey = false;
    this.view = window;
    this.which = 1;
    }
}

function duckDataTransfer(files){
    this.dropEffect = "move";
    this.effectAllowed = "uninitialized";
    this.files = files;
    this.mozCursor = "auto";
    this.mozItemCount = files.length;
    this.mozSourceNode = null;
    this.mozUserCancelled = false;
    this.types = ["application/x-moz-file", "Files"];
}

function show_instructions(){
    if (!ScreenshotUI.Instruction.added){
        
        var welcome = "<style>    .screenshot_overlay {        display: block; transition: opacity 0.5s;         position: fixed;         width:100%; height:100%; left:0; top: 0;         box-sizing:border-box;         background-color:rgba(0,0,0,0.3);z-index: 99999;        text-align: center;    }    .screenshot_overlay::before{        content: ' ';        display: inline-block;        height: 100%;         margin-right:-0.25em;         vertical-align: middle;    }    .screenshot_welcome {        vertical-align: middle;        border-radius: 5px;         display: inline-block;         margin: auto;         padding: 30px;        width: 600px;        background-color: white;         box-sizing:border-box;        box-shadow: 0 0 50px rgba(0,0,0,0.8);    }    .screenshot_code {        font-size: 0.8em; font-family: mono;         background-color:rgba(255,255,0,0.3);         border: 1px solid rgb(255,230,0); border-left-width: 5px;         padding: 10px; padding-left: 20px;         margin: 10px;    }    .screenshot_message {        background-color:rgba(230,100,255,0.3);         border: 0 solid rgb(230,100,255);         border-top-width: 5px; border-bottom-width: 5px;         padding: 10px; padding-left: 20px; margin: 10px;    }</style><h2><center>欢迎使用微信截图助手!</center></h2><div class='screenshot_message'>  您已成功安装浏览器插件, 但是看起来截图后端没有正常运行。截图工具需要依赖截图后端截取屏幕图像。您可以尝试下面的简易排错步骤重新配置或重启截图后端，或访问<a href='https://github.com/imkzh/WechatScreenshotHelper' style='font-weight: 900; color: #7e0078;'>代码主页</a>获取更多帮助。<br /></div>* 如果你还没有安装过截图后端：打开终端并输入以下代码<div class='screenshot_code'>  git clone https://github.com/imkzh/WechatScreenshotHelper<br />  cd WechatScreenshotHelper<br />  python3 ./config.py install<br /></div><br />* 如果你已经安装过截图后端，那么可能是后端因为某些原因没有正常启动，打开终端输入以下代码来启动后端：<div class='screenshot_code'>  cd WechatScreenshotHelper <br />  bash ./wechathelperd.sh start <br /></div>在后端成功启动后，请再次尝试截图（可能需要刷新页面）。<center><h3><strong>双击</strong><span style='color: gray;'>任意位置隐藏此提示。</span></h3></center>";
    
        ScreenshotUI.Instruction.element = document.createElement("div");
        ScreenshotUI.Instruction.element.className = "screenshot_overlay";
        ScreenshotUI.Instruction.element.id = "screenshot_overlay";

        var wel = document.createElement("div");
        wel.innerHTML = welcome;
        wel.className = "screenshot_welcome";
    
        ScreenshotUI.Instruction.element.appendChild(wel);
        document.body.appendChild(ScreenshotUI.Instruction.element);
    
        ScreenshotUI.Instruction.element.ondblclick = (e)=>{
            ScreenshotUI.Instruction.element.style.opacity = '0';
            setTimeout(()=>{ScreenshotUI.Instruction.element.style.display="none";}, 510);
        }
    }else{
        ScreenshotUI.Instruction.element.elementerlay.style.display="block";
        ScreenshotUI.Instruction.element.style.opacity = '1';
    }
}

function dataURItoBlob(dataURI) {
    // convert base64 to raw binary data held in a string
    // doesn't handle URLEncoded DataURIs - see SO answer #6850276 for code that does this
    var byteString = atob(dataURI.split(',')[1]);
  
    // separate out the mime component
    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]
  
    // write the bytes of the string to an ArrayBuffer
    var ab = new ArrayBuffer(byteString.length);
  
    // create a view into the buffer
    var ia = new Uint8Array(ab);
  
    // set the bytes of the buffer to the correct values
    for (var i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }
  
    // write the ArrayBuffer to a blob, and you're done
    var blob = new Blob([ab], {type: mimeString});
    return blob;
  
  }

function show_preview(){

    if (!ScreenshotUI.Preview.added){
        inject_style(".thumb_preview {display: block; background-color: #ffe; position: fixed; border-radius: 10px; border: 8px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3); transition: opacity 0.5s; max-width: 200px; max-height: 200px;}")
        ScreenshotUI.Preview.element = document.createElement("img");
        ScreenshotUI.Preview.element.className = "thumb_preview";
        ScreenshotUI.Preview.element.setAttribute("title", "Click to edit, Right-click to hide.");
        ScreenshotUI.Preview.element.onclick = function(e){
            hide_preview();
            show_editor();
        }

        ScreenshotUI.Preview.element.oncontextmenu = function(e){
            hide_preview();
            return false;
        };

        ScreenshotUI.Preview.element.onmouseenter = function(e){
            if (ScreenshotUI.Preview.visible){
                ScreenshotUI.Preview.element.style.opacity = "0.3";
            }
        };
        
        ScreenshotUI.Preview.element.onmouseleave = function(e){
            if(ScreenshotUI.Preview.visible){
                ScreenshotUI.Preview.element.style.opacity = "1";
            }
        };

        hide_preview();
        document.body.appendChild(ScreenshotUI.Preview.element);
        ScreenshotUI.Preview.added = true;
    }

    if (pending_screenshot){
        ScreenshotUI.Preview.visible = true;
        var fr = new FileReader();
        fr.onload = function(e){
            ScreenshotUI.Preview.element.src = e.target.result;
            ScreenshotUI.Preview.element.onload = function(ee){
                var snd_bbox = ScreenshotUI.sendScreenshotBtn.getBoundingClientRect();
                var cx = (snd_bbox.left + snd_bbox.right) / 2;

                var ph = ScreenshotUI.Preview.element.offsetHeight;
                var pw = ScreenshotUI.Preview.element.offsetWidth;
                if (ScreenshotUI.Preview.visible){
                    ScreenshotUI.Preview.element.style.left = (cx - (pw / 2)) + "px" ;
                    ScreenshotUI.Preview.element.style.top = (snd_bbox.top - ph - 5) + "px";
                    ScreenshotUI.Preview.element.style.visibility = "visible";
                    ScreenshotUI.Preview.element.style.opacity = 1;
                }
            };
        };
        fr.readAsDataURL(pending_screenshot);
    }

}

function measure_text_size(text, font_size, font_family="Sans"){
    ensure_texttool_template();
    EditorUI.textTemplate.measurediv.textContent = text;
    EditorUI.textTemplate.measurediv.style.fontSize = font_size;
    EditorUI.textTemplate.measurediv.style.fontFamily = font_family;
    return {width: EditorUI.textTemplate.measurediv.offsetWidth, height: EditorUI.textTemplate.measurediv.offsetHeight};
}

function editor_texttool_setcolor(color){
    EditorUI.textTemplate.rect.setAttribute("fill", "rgb(" + color[0] + ", " + color[1] + ", " + color[2] + ")");
}

function editor_texttool_settext(text, font_size, font_family="Sans"){
    ensure_texttool_template();

    sz = measure_text_size(text, font_size, font_family);
    
    padded = {height: 0, width: 0};
    padded.height = sz.height + 5 * 2;
    padded.width = sz.width + padded.height

    EditorUI.textTemplate.element.setAttribute("width", padded.width);
    EditorUI.textTemplate.element.setAttribute("height", padded.height);
    EditorUI.textTemplate.element.style.borderRadius = padded.height + "px";

    EditorUI.textTemplate.mask_text.setAttribute("style", "font-size: " + font_size + "; font-family: " + font_family + "; font-weight: 900;");
    EditorUI.textTemplate.mask_text.textContent = text;
    EditorUI.textTemplate.mask_text.fontSize = font_size;
    EditorUI.textTemplate.mask_text.fontFamily = font_family;
}

function hide_textprompt(canceled=false){
    EditorStatus.texttool.promptVisible = false;
    EditorUI.textInputOverlay.style.opacity = 0;
    EditorUI.textInputOverlay.style.pointerEvents = 'none';

    if (canceled){
        if (EditorUI.textInputCancel.onclick){
            EditorUI.textInputCancel.onclick();
        }
    }

    setTimeout(() => {
        if (!EditorStatus.texttool.promptVisible){
            EditorUI.textInputOverlay.style.visibility = "hidden";
        }
    }, 500);
}

function show_textprompt(){
    EditorStatus.texttool.promptVisible = true;
    EditorUI.textInputOverlay.style.opacity = 1;
    EditorUI.textInputOverlay.style.visibility = "visible";
    EditorUI.textInputOverlay.style.pointerEvents = 'all';
}

function clear_textprompt(){
    EditorUI.textInput.value = "";
}

function editor_PromptforText(cb_confirm, cb_canceled){
    EditorUI.textInputConfirm.onclick = ()=>{
        hide_textprompt();
        cb_confirm(EditorUI.textInput.value);

        EditorUI.textInputCancel.onclick = null;
        EditorUI.textInputConfirm.onclick = null;
    };

    EditorUI.textInputCancel.onclick = ()=>{
        hide_textprompt();
        cb_canceled(EditorUI.textInput.value);

        EditorUI.textInputCancel.onclick = null;
        EditorUI.textInputConfirm.onclick = null;
    };

    EditorUI.textInput.onkeypress = (e)=>{

        if (e.which == 13){

            if (EditorUI.textInput.value.length > 0){
                EditorUI.textInputConfirm.onclick();
            }else{
                EditorUI.textInputCancel.onclick();
            }
        }
        if (e.which == 27){
            EditorUI.textInputCancel.onclick();
        }
    }

    show_textprompt();
    EditorUI.textInput.focus();
}

function ensure_texttool_template(){
    if (EditorUI.textTemplate){
        return;
    } else {

        EditorUI.textTemplate = {wrapper: document.createElement("div"), element: document.createElementNS(SVGNS, "svg:svg"), measurediv: document.createElement("div")};
        // make div for textsize measurement.
        inject_style(".editor_texttool_measurement {display: block; visibility:hidden/*visible*/; padding: 0; margin: 0; border: none; position: absolute; top: 0; left: 0;}");
        EditorUI.textTemplate.measurediv.className = "editor_texttool_measurement";

        // make svg template
        inject_style(".editor_texttool_template_wrapper {visibility:hidden/*visible*/; position: absolute; top: 0; left: 0;}");
        EditorUI.textTemplate["element"].style.borderRadius = "40px";
        EditorUI.textTemplate["element"].setAttribute("xmlns", SVGNS);
        EditorUI.textTemplate["element"].setAttribute("xmlns:svg", SVGNS);

        EditorUI.textTemplate["wrapper"].className = "editor_texttool_template_wrapper"
        EditorUI.textTemplate["wrapper"].appendChild(EditorUI.textTemplate.element)
        
        EditorUI.textTemplate["style"] = document.createElement("style");

        EditorUI.textTemplate["rect"] = document.createElementNS(SVGNS, "svg:rect");
        EditorUI.textTemplate["rect"].setAttribute("width", "100%");
        EditorUI.textTemplate["rect"].setAttribute("height", "100%");
        EditorUI.textTemplate["rect"].setAttribute("fill", "#fff");
        EditorUI.textTemplate["rect"].setAttribute("x", "0");
        EditorUI.textTemplate["rect"].setAttribute("y", "0");
        EditorUI.textTemplate["rect"].setAttribute("mask", "url(#mask_text)");

        EditorUI.textTemplate["mask"] = document.createElementNS(SVGNS, "svg:mask");
        EditorUI.textTemplate["mask"].id = "mask_text";

        EditorUI.textTemplate["mask_rect"] = document.createElementNS(SVGNS, "svg:rect");
        EditorUI.textTemplate["mask_rect"].setAttribute("width", "100%");
        EditorUI.textTemplate["mask_rect"].setAttribute("height", "100%");
        EditorUI.textTemplate["mask_rect"].setAttribute("fill", "#fff");
        EditorUI.textTemplate["mask_rect"].setAttribute("x", "0");
        EditorUI.textTemplate["mask_rect"].setAttribute("y", "0");

        EditorUI.textTemplate["mask_text"] = document.createElementNS(SVGNS, "svg:text");
        EditorUI.textTemplate["mask_text"].setAttribute("class", "cutout_text"); // .className property cannot be used here.
        EditorUI.textTemplate["mask_text"].setAttribute("fill", "#000");
        EditorUI.textTemplate["mask_text"].setAttribute("dominantBaseline", "middle");
        EditorUI.textTemplate["mask_text"].setAttribute("text-anchor", "middle");
        EditorUI.textTemplate["mask_text"].setAttribute("x", "50%");
        EditorUI.textTemplate["mask_text"].setAttribute("y", "50%");
        EditorUI.textTemplate["mask_text"].setAttribute("dy", ".3em");

        EditorUI.textTemplate["mask"].appendChild(EditorUI.textTemplate["mask_rect"]);
        EditorUI.textTemplate["mask"].appendChild(EditorUI.textTemplate["mask_text"]);

        EditorUI.textTemplate["element"].append(EditorUI.textTemplate["style"]);
        EditorUI.textTemplate["element"].append(EditorUI.textTemplate["rect"]);
        EditorUI.textTemplate["element"].append(EditorUI.textTemplate["mask"]);

        document.body.appendChild(EditorUI.textTemplate.wrapper);
        document.body.appendChild(EditorUI.textTemplate.measurediv);

        // append the text editor input.
        inject_style(".editor_textinput_overlay {background-color: rgba(0,0,0,0.8); position: absolute; left: 0; top: 0; width: 100%; height: 100%; line-height: 50px; transition: opacity 0.5s;}");
        inject_style(".editor_textinput_overlay:before {content:' '; display: inline-block; height: 100%; margin-right:-0.25em; vertical-align: middle;}");
        inject_style(".editor_textinput {float: left; border:none; display: inline-block; font-size: 25px; background-color: white; border-radius: 40px; height: 40px; padding:5px 20px; box-sizing: border-box;}");
        inject_style(".editor_textinput_wrapper {display: inline-block;}");
        inject_style(".editor_textinput_button {float: left; display: inline-block; height: 40px; width: 40px; margin: 0 10px; border: 4px solid rgba(0,0,0,0);}");
        inject_style(".editor_textinput_selection {float:left; border:none; display: inline-block; font-size: 15px; border-radius: 40px; height: 40px; width: 80px; padding:5px 10px; box-sizing: border-box; margin: 0 10px;}");
        inject_style(".editor_textinput_selection {background: url(" + Icons.drop_down + ") no-repeat 100% 50%; background-color: white; -moz-appearance: none; -webkit-appearance: none; appearance: none;}");

        EditorUI.textInputOverlay = document.createElement("div");
        EditorUI.textInputOverlay.className = "editor_textinput_overlay";
        EditorUI.textInputOverlay.style.visibility = "hidden";
        EditorUI.textInputOverlay.style.opacity = 0;

        EditorUI.textInputWrapper = document.createElement("div");
        EditorUI.textInputWrapper.className = "editor_textinput_wrapper";


        EditorUI.textInput = document.createElement("input");
        EditorUI.textInput.className = "editor_textinput";
        EditorUI.textInputConfirm = create_toolbar_item(Icons.confirm);
        EditorUI.textInputCancel = create_toolbar_item(Icons.cancel);
        EditorUI.textInputConfirm.className += " editor_textinput_button";
        EditorUI.textInputCancel.className += " editor_textinput_button";

        options = [["小", "10px"], ["中", "20px", true], ["大", "40px"], ["超大", "50px"]];

        EditorUI.textSizeSelection = document.createElement("select");
        EditorUI.textSizeSelection.className = "editor_textinput_selection";
        for (var idx=0; idx < options.length; idx++){
            var opt = document.createElement("option");
            opt.textContent = options[idx][0];
            opt.value = options[idx][1];
            if (options[idx].length > 2){
                opt.selected = true;
            }
            EditorUI.textSizeSelection.appendChild(opt);
        }
        
        EditorUI.textInputWrapper.appendChild(EditorUI.textSizeSelection);
        EditorUI.textInputWrapper.appendChild(EditorUI.textInput);
        EditorUI.textInputWrapper.appendChild(EditorUI.textInputConfirm);
        EditorUI.textInputWrapper.appendChild(EditorUI.textInputCancel);
        
        EditorUI.textInputOverlay.appendChild(EditorUI.textInputWrapper);

        EditorUI.root.appendChild(EditorUI.textInputOverlay);
    }
}

function editor_update_context_styles(){
    EditorUI.ctx.strokeStyle = "rgb(" + editor_current_color[0] + ", " + editor_current_color[1] + ", " + editor_current_color[2] + ")";
    EditorUI.ctx.fillStyle = "rgb(" + editor_current_color[0] + ", " + editor_current_color[1] + ", " + editor_current_color[2] + ")";
    EditorUI.ctx.lineCap = "round";
    EditorUI.ctx.lineWidth = 3;
}

function select_tool(toolele, toolname){

    for (var idx=0; idx < EditorUI.toolbarItems.length; idx++){
        if (EditorUI.toolbarItems[idx].attributes["selected"].value == "true"){

            // deselect every tool.
            EditorUI.toolbarItems[idx].setAttribute("selected", false);

            if (typeof EditorUI.toolbarItems[idx].toolId !== 'undefined'){
                if (EditorUI.toolbarItems[idx].toolId != toolname){
                    // be sure we are not resetting the tool (we are exiting the tool).
                    if (typeof ToolEvents[EditorUI.toolbarItems[idx].toolId] !== "undefined" && typeof ToolEvents[EditorUI.toolbarItems[idx].toolId].exit !== "undefined"){
                        // if exit Events defined for this tool
                        ToolEvents[EditorUI.toolbarItems[idx].toolId].exit();
                    }
                }
                
            }
        }
    }

    // select the specified tool
    toolele.setAttribute("selected", true);

    if (typeof toolele.toolId !== 'undefined'){
        if (EditorStatus.currentTool == toolname){
            // we are resetting the tool.
            if (typeof ToolEvents[toolele.toolId] !== "undefined" && typeof ToolEvents[toolele.toolId].reset !== "undefined"){
                // if exit Events defined for this tool
                ToolEvents[toolele.toolId].reset();
            }
        } else {
            if (typeof ToolEvents[toolele.toolId] !== "undefined" && typeof ToolEvents[toolele.toolId].enter !== "undefined"){
                // if exit Events defined for this tool
                ToolEvents[toolele.toolId].enter();
            }
        }
    }
    
    EditorStatus.currentTool = toolname;

    // redraw image.
    editor_restore_image();
    editor_update_context_styles();
}

function select_color(colorele, colorname){

    for (var idx=0; idx < EditorUI.colorbarItems.length; idx++){
        EditorUI.colorbarItems[idx].setAttribute("selected", false);
    }
    colorele.setAttribute("selected", true);
    editor_current_color = colorname;

    editor_update_context_styles();

    editor_texttool_update_cache((img)=>{
        EditorUI.ctx.drawImage(img, EditorStatus.texttool.location.x, EditorStatus.texttool.location.y);
        EditorUI.ctx.strokeRect(EditorStatus.texttool.location.x - 3 , EditorStatus.texttool.location.y - 3, EditorStatus.texttool.cachedImage.width + 6, EditorStatus.texttool.cachedImage.height + 6);
    });
}

function create_toolbar_item(icon){
    var ele = document.createElement("img");
    ele.className = "editor_toolbar_item";
    ele.setAttribute("selected", false);
    ele.src = icon;
    return ele;
}

function assign_toolbar_item_id(element, id){
    element.toolId = id;
}

function editor_undo(){

    if (typeof ToolEvents[EditorStatus.currentTool] !== "undefined" && typeof ToolEvents[EditorStatus.currentTool].undo !== "undefined"){
        console.log("undo procedure is defined for current tool:", EditorStatus.currentTool);                    
        rtn = ToolEvents[EditorStatus.currentTool].undo();
        if (typeof rtn !== "undefined" && rtn !== true){
            console.log("undo procedure is blocked.");            
            return;
        }
    }

    if (EditorStatus.editHistory.length > 0){ // if we can redo
        var state = EditorStatus.editHistory.pop();
        EditorStatus.editFuture.push(EditorStatus.currentImage);
        EditorStatus.currentImage = state;

        editor_restore_image();
    }
}

function editor_redo(){

    if (typeof ToolEvents[EditorStatus.currentTool] !== "undefined" && typeof ToolEvents[EditorStatus.currentTool].redo !== "undefined"){
        console.log("redo procedure is defined for current tool:", EditorStatus.currentTool);                    
        rtn = ToolEvents[EditorStatus.currentTool].redo();
        if (typeof rtn !== "undefined" && rtn !== true){
            console.log("redo procedure is blocked.");
            return;
        }
    }

    if (EditorStatus.editFuture.length > 0){ // if we can redo
        var state = EditorStatus.editFuture.pop();
        EditorStatus.editHistory.push(EditorStatus.currentImage);
        EditorStatus.currentImage = state;

        editor_restore_image();
    }
}

function update_pending_screenshot_fromEditor(noHistory=false){
    
    // if we did some edit: 1) add to history, 2) clear the future
    if (!noHistory){
        if (EditorStatus.editHistory.length > 20){
            // we are holding too much history
            EditorStatus.editHistory.shift(); // remove the first(the oldest) item in history. 
        }
        EditorStatus.editHistory.push(EditorStatus.currentImage);
        EditorStatus.editFuture.length = 0;  // this will clear the future array.
    }

    EditorStatus.currentImage = EditorUI.canvas.toDataURL();
    var b = dataURItoBlob(EditorStatus.currentImage);
    pending_screenshot = new File([b], "capture.png", {type: 'image/png'});

}

function editor_restore_image(cb_finished){
    var img = new Image()
    img.onload = ()=>{
        EditorUI.ctx.drawImage(img, 0, 0);
        if (cb_finished){
            cb_finished(img);
        }
    }
    img.src = EditorStatus.currentImage;
}

function editor_texttool_update_cache(cb_cacheloaded){
    if (EditorStatus.currentTool == Tools.TEXT && EditorStatus.texttool.text != null){
        // update the cached image.
        editor_texttool_setcolor(editor_current_color);
        var img = new Image();
        img.onload = function(){
            if (cb_cacheloaded){
                cb_cacheloaded(img);
            }
        } 
        EditorStatus.texttool.cachedImage = img;
        img.src = "data:image/svg+xml;base64," + btoaUTF8(EditorUI.textTemplate.element.outerHTML);
    }
}

function editor_startTextProcedure(){
    editor_PromptforText(
        (txt)=>{
            // on_confirm
            editor_texttool_settext(txt, EditorUI.textSizeSelection.options[EditorUI.textSizeSelection.selectedIndex].value);

            EditorStatus.texttool.text = txt;
            EditorStatus.texttool.location = {x: EditorStatus.mouse.x, y: EditorStatus.mouse.y}; 
            
            editor_texttool_update_cache((img)=>{
                EditorUI.ctx.drawImage(img, EditorStatus.mouse.x, EditorStatus.mouse.y);
                EditorUI.ctx.strokeRect(EditorStatus.texttool.location.x - 3 , EditorStatus.texttool.location.y - 3, EditorStatus.texttool.cachedImage.width + 6, EditorStatus.texttool.cachedImage.height + 6);
            });
        },
        (txt)=>{
            // on_cancel
            EditorStatus.texttool.text = null;
        }
    );
}

function bind_canvas_events(){
    EditorUI.canvas.onmousedown = (e)=>{

        // console.log("Mouse Down.");
        var x = (e.layerX-10) * (EditorStatus.ctxImage.width / (EditorUI.canvas.offsetWidth-20));
        var y = (e.layerY-10) * (EditorStatus.ctxImage.width / (EditorUI.canvas.offsetWidth-20));

        EditorStatus.mouse = {x: x, y: y};
        EditorStatus.mouse.downLocation = {x: x, y: y};
        EditorStatus.mouse.down = true;
        EditorStatus.mouse.moved = false;

    };

    EditorUI.canvas.onmousemove = (e)=>{
        if (!EditorStatus.mouse.down) return;
        // console.log("Mouse Move.");
        
        EditorStatus.mouse.moved = true;

        EditorStatus.mouse.previousLocation = {x: EditorStatus.mouse.x, y: EditorStatus.mouse.y};

        // offset 10 px for border: EditorUI.canvas.style.borderWidth = "10px";
        var x = (e.layerX-10) * (EditorStatus.ctxImage.width / (EditorUI.canvas.offsetWidth-20)); 
        var y = (e.layerY-10) * (EditorStatus.ctxImage.width / (EditorUI.canvas.offsetWidth-20));

        EditorStatus.mouse.x = x;
        EditorStatus.mouse.y = y;

        editor_update_context_styles();

        if (EditorStatus.currentTool == Tools.PENCIL){
            EditorUI.ctx.beginPath();
            EditorUI.ctx.moveTo(EditorStatus.mouse.previousLocation.x, EditorStatus.mouse.previousLocation.y);
            EditorUI.ctx.lineTo(EditorStatus.mouse.x, EditorStatus.mouse.y);
            EditorUI.ctx.stroke();
        } else if (EditorStatus.currentTool == Tools.ARROW){
            // restore the current image and draw arrow from start location to end location.

            editor_restore_image((img)=>{
                dx = EditorStatus.mouse.x - EditorStatus.mouse.downLocation.x;
                dy = EditorStatus.mouse.y - EditorStatus.mouse.downLocation.y;
                
                var arrow_length = Math.sqrt(dx*dx + dy*dy);
                var head_size = arrow_length * 0.15;
                head_size = head_size < 10 ? 10 : head_size;
                head_size = head_size > 40 ? 40 : head_size;
                var head_height = head_size / 1.8;

                var hratio = head_size / arrow_length;
                var neck_point = {x: EditorStatus.mouse.x - dx * hratio, y: EditorStatus.mouse.y - dy * hratio};
                var neck_point_back = {x: EditorStatus.mouse.x - dx * (hratio * 1.1), y: EditorStatus.mouse.y - dy * (hratio * 1.1)};

                var vperp = {x: -dy/arrow_length, y: dx/arrow_length};
                
                EditorUI.ctx.beginPath();
                EditorUI.ctx.moveTo(EditorStatus.mouse.downLocation.x, EditorStatus.mouse.downLocation.y);
                EditorUI.ctx.lineTo(neck_point.x + vperp.x * head_height / 3, neck_point.y + vperp.y * head_height / 3);
                EditorUI.ctx.lineTo(neck_point_back.x + vperp.x * head_height, neck_point_back.y + vperp.y * head_height);
                EditorUI.ctx.lineTo(EditorStatus.mouse.x, EditorStatus.mouse.y);
                EditorUI.ctx.lineTo(neck_point_back.x - vperp.x * head_height, neck_point_back.y - vperp.y * head_height);
                EditorUI.ctx.lineTo(neck_point.x - vperp.x * head_height / 3, neck_point.y - vperp.y * head_height / 3);
                EditorUI.ctx.closePath()
                EditorUI.ctx.fill();

                if (!EditorStatus.mouse.down){
                    update_pending_screenshot_fromEditor(true);
                }
            });

        } else if (EditorStatus.currentTool == Tools.RECT){
            editor_restore_image((img)=>{
                dx = EditorStatus.mouse.x - EditorStatus.mouse.downLocation.x;
                dy = EditorStatus.mouse.y - EditorStatus.mouse.downLocation.y;
                EditorUI.ctx.strokeRect(EditorStatus.mouse.downLocation.x, EditorStatus.mouse.downLocation.y, dx, dy);
            
                if (!EditorStatus.mouse.down){
                    update_pending_screenshot_fromEditor(true);
                }
            });
        } else if (EditorStatus.currentTool == Tools.TEXT) {

            if (EditorStatus.texttool.text){
                editor_restore_image((img)=>{
                    var dx = (EditorStatus.mouse.x - EditorStatus.mouse.previousLocation.x);
                    var dy = (EditorStatus.mouse.y - EditorStatus.mouse.previousLocation.y);
                    var r = (EditorStatus.ctxImage.width / EditorUI.canvas.offsetWidth);

                    EditorStatus.texttool.location.x += dx;
                    EditorStatus.texttool.location.y += dy;

                    EditorUI.ctx.drawImage(EditorStatus.texttool.cachedImage, EditorStatus.texttool.location.x, EditorStatus.texttool.location.y);
                    EditorUI.ctx.strokeRect(EditorStatus.texttool.location.x - 3 , EditorStatus.texttool.location.y - 3, EditorStatus.texttool.cachedImage.width + 6, EditorStatus.texttool.cachedImage.height + 6);
                });
            }
        }
    };

    EditorUI.canvas.onmouseup = (e) => {
        if (!EditorStatus.mouse.down) return;
        EditorStatus.mouse.down = false;
        EditorStatus.mouse.down = false;

        // console.log("Mouse Up.");
        if (EditorStatus.currentTool == Tools.PENCIL){
            // update image.
            update_pending_screenshot_fromEditor()
        } else if (EditorStatus.currentTool == Tools.ARROW){
            update_pending_screenshot_fromEditor()
        } else if (EditorStatus.currentTool == Tools.RECT){
            update_pending_screenshot_fromEditor()
        } else if (EditorStatus.currentTool == Tools.TEXT) {
            if (EditorStatus.texttool.text == null){
                if (!EditorStatus.mouse.moved){ // click when no text is defined.
                    editor_startTextProcedure();
                }
            } else {
                if (!EditorStatus.mouse.moved){ // click when text is defined.
                    var img = new Image();
                    img.onload = ()=>{ 
                        EditorUI.ctx.drawImage(img, 0, 0);
                        EditorUI.ctx.drawImage(EditorStatus.texttool.cachedImage, EditorStatus.texttool.location.x, EditorStatus.texttool.location.y);
                        update_pending_screenshot_fromEditor();
                    }
                    img.src = EditorStatus.currentImage;
                    EditorStatus.texttool.text = null;
                }
            }
        }
    };
}

function add_editor(){
    if (!EditorStatus.added){
        inject_style(".editor {    line-height:100%;    display: block;    text-align: center;    white-space: nowrap;    justify-content: center;    align-items: center;    z-index:9999;    background-color:rgba(0,0,0,0.6);    position: fixed;    width:100%;    height:100%;    box-sizing: border-box;    left:0;    top:0;    overflow: hidden;    transition: opacity 0.5s;}/* .editor_canvas_wrapper {    display: inline-block;    vertical-align: middle;    box-shadow: 0 0 40px rgb(255, 255, 255, 0.5);    padding:0;    border:10px solid white;    border-radius: 15px;    max-width: 80%;    max-height: 80%;    overflow: hidden;    position:relative;} */.editor:before {    content: ' ';    display: inline-block;    height: 100%;    vertical-align: middle;    margin-right:-0.25em;}.editor_canvas {    display: inline-block;    vertical-align: middle;    box-shadow: 0 0 40px rgb(255, 255, 255, 0.5);    border:10px solid white;    border-radius: 15px;    max-width: 80%;    max-height: 80%;    /*make pointer event layerX and layerY relative to the left-top corner of canvas */    position:relative; }.editor_toolbar {    display: flex;    align-items:center;    justify-content: center;    background-color: rgb(46, 50, 56);    border-radius: 5px 5px 0 0;    box-shadow: 0 0 30px rgb(0,0,0);    width: 800px;    height: 80px;    padding: 10px;    box-sizing: border-box;    bottom:0;    left:0;    right:0;    margin: auto;    position:absolute;}.editor_toolbar_item {    display:block;    width: 40px;    height: 40px;    margin: auto 5px;    line-height: 40px;    text-align:center;    font-size: 40px;    overflow: hidden;    border-radius: 4px;    font-family: sans;    color: white;    font-weight: 900;    border: 5px solid rgba(255,255,255,0);    box-sizing: border-box;}.editor_toolbar_item:hover {    background-color: rgba(255, 255, 255, 0.3);}.editor_toolbar_item[selected='true'] {    box-shadow: 0 0 5px white;}.editor_toolbar_item[color='true'] {    border-radius: 40px;}");

        EditorStatus.mouse = {};

        EditorUI.root = document.createElement("div");
        EditorUI.root.className = "editor";

        EditorUI.canvas = document.createElement("canvas");
        EditorUI.canvas.className = "editor_canvas";

        EditorUI.ctx = EditorUI.canvas.getContext("2d");

        bind_canvas_events();

        EditorUI.toolbar = document.createElement("div");
        EditorUI.toolbar.className = "editor_toolbar";

        EditorUI.deliverBtn = create_toolbar_item(Icons.confirm);
        EditorUI.deliverBtn.onclick = function(){
            hide_editor();
            send_pending_screenshot();
        }; EditorUI.deliverBtn.title = "发送截图";

        EditorUI.quitEditingBtn = create_toolbar_item(Icons.cancel);
        EditorUI.quitEditingBtn.onclick = function(){
            hide_editor();
        }; EditorUI.quitEditingBtn.title = "隐藏编辑器";

        var undobutton = create_toolbar_item(Icons.backward);
        undobutton.onclick = function(){editor_undo()};
        undobutton.title = "撤销";
        
        var redobutton = create_toolbar_item(Icons.forward);
        redobutton.title = "重做";
        redobutton.onclick = function(){editor_redo()};


        var drawbox = create_toolbar_item(Icons.rectangle);
        assign_toolbar_item_id(drawbox, Tools.RECT);
        drawbox.onclick = function(){select_tool(drawbox, Tools.RECT);};
        drawbox.title = "绘制工具: 矩形";

        var pencil = create_toolbar_item(Icons.pencil);
        assign_toolbar_item_id(pencil, Tools.PENCIL);
        pencil.onclick = function(){select_tool(pencil, Tools.PENCIL);};
        pencil.title = "绘制工具: 画笔";

        var arrowtool = create_toolbar_item(Icons.arrow);
        assign_toolbar_item_id(arrowtool, Tools.ARROW);
        arrowtool.onclick = function(){
            select_tool(arrowtool, Tools.ARROW);
        }; arrowtool.title = "绘制工具: 箭头";
        
        EditorStatus.texttool = {fontsize: 1, text: null};

        ToolEvents[Tools.TEXT] = {
            enter: ()=>{
                EditorStatus.texttool.text = null;
            },
            exit: ()=>{
                if (EditorStatus.texttool.text){
                    // if the pending text is not placed down.
                    EditorStatus.texttool.text = null;
                    editor_restore_image();
                } else {
                    // if there is no pending text.
                }

                if (EditorStatus.texttool.promptVisible){
                    hide_textprompt(true);
                }
            },
            reset: ()=>{
                // the tool icon is clicked for a second time.
                if (EditorStatus.texttool.text){
                    
                    editor_PromptforText(
                        (txt)=>{
                            // on_confirm
                            // we are changing text here.
                            editor_texttool_settext(txt, EditorUI.textSizeSelection.options[EditorUI.textSizeSelection.selectedIndex].value);

                            EditorStatus.texttool.text = txt;
                            EditorStatus.texttool.location = {x: EditorStatus.mouse.x, y: EditorStatus.mouse.y}; 
                            
                            editor_restore_image((background)=>{
                                editor_texttool_update_cache((img)=>{
                                    EditorUI.ctx.drawImage(img, EditorStatus.mouse.x, EditorStatus.mouse.y);
                                    EditorUI.ctx.strokeRect(EditorStatus.texttool.location.x - 3 , EditorStatus.texttool.location.y - 3, EditorStatus.texttool.cachedImage.width + 6, EditorStatus.texttool.cachedImage.height + 6);
                                });
                            });
                        },
                        (txt)=>{
                            EditorStatus.texttool.text = null;
                        }
                    );
                } else {
                    // we are initializing a new text procedure:
                    EditorStatus.mouse.x = EditorStatus.ctxImage.width / 2
                    EditorStatus.mouse.y = EditorStatus.ctxImage.height / 2
                    editor_startTextProcedure();
                }
            },
            redo: ()=>{
                if (EditorStatus.texttool.text) {
                    console.log("texttool.redo() blocked the redo procedure.");
                    EditorStatus.texttool.text = null;
                    editor_restore_image();
                    return false;
                }
                return true;
            },
            undo: ()=>{
                if (EditorStatus.texttool.text) {
                    console.log("texttool.undo() blocked the redo procedure.");
                    EditorStatus.texttool.text = null;
                    editor_restore_image();
                    return false;
                }
                return true;
            }
        };

        var texttool = create_toolbar_item(Icons.addtext);
        assign_toolbar_item_id(texttool, Tools.TEXT);
        texttool.onclick = function(){
            select_tool(texttool, Tools.TEXT);
        }; texttool.title = "添加文字";

        var discard = create_toolbar_item(Icons.discard);
        discard.onclick = function(){
            hide_editor();
            hide_sendscreenshot_button();
            pending_screenshot = null;
            EditorStatus.editHistory.length = 0;
            EditorStatus.editFuture.length = 0;
        }; discard.title = "丢弃截图";

        var color_white = create_toolbar_item(Icons.dot_white);
        var color_black = create_toolbar_item(Icons.dot_black);
        var color_red = create_toolbar_item(Icons.dot_red);
        var color_yellow = create_toolbar_item(Icons.dot_yellow);
        var color_green = create_toolbar_item(Icons.dot_green);
        var color_blue = create_toolbar_item(Icons.dot_blue);

        color_white.onclick = () => {select_color(color_white, Colors.white)}; 
        color_black.onclick = () => {select_color(color_black, Colors.black)};
        color_red.onclick = () => {select_color(color_red, Colors.red)};
        color_yellow.onclick = () => {select_color(color_yellow, Colors.yellow)};
        color_green.onclick = () => {select_color(color_green, Colors.green)};
        color_blue.onclick = () => {select_color(color_blue, Colors.blue)};

        var toolbarItems = [];
        var colorbarItems = [];

        toolbarItems.push(discard);
        toolbarItems.push(undobutton);
        toolbarItems.push(redobutton);
        toolbarItems.push(pencil);
        toolbarItems.push(drawbox);
        toolbarItems.push(arrowtool);
        toolbarItems.push(texttool);

        colorbarItems.push(color_red);
        colorbarItems.push(color_yellow);
        colorbarItems.push(color_green);
        colorbarItems.push(color_blue);
        colorbarItems.push(color_white);
        colorbarItems.push(color_black);

        EditorUI["toolbarItems"] = toolbarItems;
        EditorUI["colorbarItems"] = colorbarItems;

        for (var idx=0; idx < toolbarItems.length; idx++){
            EditorUI.toolbar.appendChild(toolbarItems[idx]);
        }
        for (var idx=0; idx < colorbarItems.length; idx++){
            colorbarItems[idx].setAttribute("color", true);
            EditorUI.toolbar.appendChild(colorbarItems[idx]);
        }

        EditorUI.toolbar.appendChild(EditorUI.quitEditingBtn);
        EditorUI.toolbar.appendChild(EditorUI.deliverBtn);

        EditorUI.root.appendChild(EditorUI.canvas);
        EditorUI.root.appendChild(EditorUI.toolbar);
        
        document.body.appendChild(EditorUI.root);
        
        select_color(color_red, Colors.red);
        select_tool(pencil, Tools.PENCIL);

        EditorStatus.added = true;
        hide_editor();
    }
    ensure_texttool_template();
}

function show_editor(){
    if (!EditorStatus.added){
        add_editor();
    }

    if (pending_screenshot){ // editor can only show up when there is a pending image. 
        EditorStatus.visible = true;
        EditorStatus.mouse.donw = false;

        EditorStatus.ctxImage = new Image()
        EditorStatus.ctxImage.onload = function(){
            if (EditorStatus.visible){
                EditorUI.canvas.width = EditorStatus.ctxImage.width;
                EditorUI.canvas.height = EditorStatus.ctxImage.height;

                EditorUI.ctx.drawImage(EditorStatus.ctxImage, 0, 0);

                EditorUI.root.setAttribute("disabled", false);
                EditorUI.root.style.visibility = "visible";
                EditorUI.root.style.opacity = 1;
            }
            EditorStatus.currentImage = EditorUI.canvas.toDataURL();
        };
        EditorStatus.ctxImage.src = ScreenshotUI.Preview.element.src;
    }
}

function hide_editor(){
    // save current edited image to preview and hide editor.
    
    if (!EditorStatus.added) {
        return;
    }
    EditorStatus.visible = false;
    EditorStatus.mouse.down = false;
    
    EditorUI.root.setAttribute("disabled", true);
    
    EditorUI.root.style.opacity = 0;
    setTimeout(() => {
        if (!EditorStatus.visible){
            EditorUI.root.style.visibility = "hidden";
        }
    }, 500);
    
    

}

function hide_preview(){
    if (ScreenshotUI.Preview.added){
        ScreenshotUI.Preview.visible = false;
        ScreenshotUI.Preview.element.style.opacity = 0;
        setTimeout(() => {
            if (!ScreenshotUI.Preview.visible){
                ScreenshotUI.Preview.element.style.visibility = "hidden";
            }
        }, 500);
    }
}

function send_pending_screenshot(){
    if (pending_screenshot){
        var dt = new duckDataTransfer([pending_screenshot]);
        var evt_dr = new duckDrop(chatroom, 114, 243, dt);

        // simulate the drag-n-drop procdure to send the image we've just captured.
        chatroom.dispatchEvent(evt_dr);

        // remove the pending screenshot and editing history.
        pending_screenshot = null;
        EditorStatus.editHistory.length = 0;
        EditorStatus.editFuture.length = 0;

        hide_sendscreenshot_button();
    }
}

/* Add send screenshot button near the send button. */
function add_sendscreenshot_button(){

    action_bar = $(".action")[0];
    inject_style(".btn_sendscreenshot {transition: margin 0.5s, opacity 0.5s; background-color:white; z-index:999; color:#222;} .btn_sendscreenshot:hover {background-color: #f8f8f8}");
    
    ScreenshotUI.sendScreenshotBtn = document.createElement("a");
    ScreenshotUI.sendScreenshotBtn.className = "btn btn_sendscreenshot";
    ScreenshotUI.sendScreenshotBtn.href = "javascript:;"
    ScreenshotUI.sendScreenshotBtn.style.marginRight = "5px";
    ScreenshotUI.sendScreenshotBtn.textContent = "编辑截图";
    ScreenshotUI.sendScreenshotBtn.title = "点击编辑截图, 右键直接发送";

    ScreenshotUI.sendScreenshotBtn.onclick = function(e){
        hide_preview();
        show_editor();
    };

    ScreenshotUI.sendScreenshotBtn.oncontextmenu = function(){
        hide_sendscreenshot_button();
        send_pending_screenshot();
        return false;
    }

    ScreenshotUI.sendScreenshotBtn.onmouseenter = function(e){
        show_preview();
    }

    // ScreenshotUI.sendScreenshotBtn.onmouseleave = function(e){
    //     hide_preview();
    // }

    var btn_send = null;
    for (var idx=0; idx < action_bar.childNodes.length; idx++){
        // iterate through childNodes to find actual send button.
        if(action_bar.childNodes[idx].classList) {
            for (var idx_cls=0; idx_cls < action_bar.childNodes[idx].classList.length; idx_cls++){
                if (action_bar.childNodes[idx].classList[idx_cls] == "btn_send"){
                    btn_send = action_bar.childNodes[idx];
                    break;
                }
            }
        }
        if (btn_send !== null){
            break;
        }
    }
    hide_sendscreenshot_button();
    action_bar.insertBefore(ScreenshotUI.sendScreenshotBtn, btn_send);
}


function hide_sendscreenshot_button(){
    ScreenshotUI.sendScreenshotBtnVisible = false;
    ScreenshotUI.sendScreenshotBtn.setAttribute("disabled", true);

    if (ScreenshotUI.sendScreenshotBtn.offsetWidth > 0){
        ScreenshotUI.sendScreenshotBtn.style.marginRight = "-" + ScreenshotUI.sendScreenshotBtn.offsetWidth + "px";
    } else {
        ScreenshotUI.sendScreenshotBtn.style.marginRight = "-98px";
    }

    ScreenshotUI.sendScreenshotBtn.style.opacity = "0";
    setTimeout(() => {
        if (!ScreenshotUI.sendScreenshotBtnVisible){
            ScreenshotUI.sendScreenshotBtn.style.visibility="hidden";
        }
    }, 2000);
    hide_preview();
}

function show_sendscreenshot_button(){
    ScreenshotUI.sendScreenshotBtn.setAttribute("disabled", false);
    ScreenshotUI.sendScreenshotBtnVisible = true;
    ScreenshotUI.sendScreenshotBtn.style.visibility="visible";
    ScreenshotUI.sendScreenshotBtn.style.marginRight = "6px";
    ScreenshotUI.sendScreenshotBtn.style.opacity = "1";
    setTimeout(() => {
        show_preview();
    }, 500);
}

function toggle_sendscreenshot_button(){
    if (ScreenshotUI.sendScreenshotBtnVisible){
        hide_sendscreenshot_button();
    }else{
        show_sendscreenshot_button();
    }
}


function request_capture(){
    if (access_key){
        var req = new XMLHttpRequest();
        req.responseType = 'arraybuffer';
        req.onreadystatechange = function(e){
            if (req.readyState == 4 && req.status == '200'){
                // returned from python backend.
                // console.log("GOT: ", req.response);
                if (req.response.byteLength > 0){
                    var b = new Blob([req.response], {type: 'image/png'});
                    var f = new File([b], "capture.png", {type: 'image/png'});
                    pending_screenshot = f;

                    // clear edit history.
                    EditorStatus.editHistory.length = 0;
                    EditorStatus.editFuture.length = 0;
                    
                    show_sendscreenshot_button();
                }
            } else if (req.readyState == 4){
                show_instructions();
            }
        };

        var u = host + "/capture" + "?access_key=" + access_key + "&random=" + Math.random();
        req.open("GET", u, true);
        req.send(null);  // signal the python backend to initial a screen shot procdure.
    } else {
        show_instructions();
    }
}

function hook_toolbar_screenshot(){
    
    var tlb = document.getElementById("tool_bar");  // get chat room tool bar
    var btn = null;
    for (var i = 0; i < tlb.children.length; i++){   // iterate througn tlb.children to find the "screensot" button.
        attr = tlb.children[i].attributes.getNamedItem("title")
        if (attr != null && (attr.value == "Screenshot" || attr.value == "截屏" || attr.value == "螢幕截圖")){
        btn = tlb.children[i];
        break;
        }
    }
    
    var new_btn = btn.cloneNode(true);  // clone the node to remove all wechat-defined event handlers.
    new_btn.onclick = function(e){  // create custom event handler
    
        if (!access_key){ // if no access key acquired, try get one first.
            getAccessKey();
            setTimeout(() => {
                request_capture();
            }, 500); 
            return;
        }
        request_capture();
    };
    tlb.replaceChild(new_btn, btn);
}

function getAccessKey(){
    var accesskey_req = new XMLHttpRequest();
    accesskey_req.timeout = 500;
    accesskey_req.onreadystatechange = function (e){
        if (accesskey_req.readyState == 4 && accesskey_req.status == '200'){
            try{
                var rtn = JSON.parse(accesskey_req.response);
                access_key = rtn["access_key"];
                console.log("Server access_key: " + access_key);
            }catch(ex){
                console.log("failed to retrieve access_key from screen capture backend.");
            }
        }
    }
    accesskey_req.open("GET", host + "/check_capability", true)
    accesskey_req.send(null);
}


add_sendscreenshot_button();
hook_toolbar_screenshot();
getAccessKey();

`;
  document.body.appendChild(sc);
}, 300);
